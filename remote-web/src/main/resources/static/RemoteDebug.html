<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <!-- 必须的 meta 标签 -->
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/codemirror.css">
    <link rel="stylesheet" href="/jstree3.3.12/themes/default/style.min.css" />

    <script src="/js/jquery.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/codemirror.js"></script>
    <!--Java代码高亮-->
    <script src="/js/clike.js"></script>
    <script src="/jstree3.3.12/jstree.min.js"></script>

    <title>Web IDE</title>
</head>

<body class="container-fluid">
        <div class="row border border-dark">
            <div class="col">
                <div class="btn-group">
                    <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                        File
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" type="button">Create File</button>
                        <button class="dropdown-item" type="button">Delete File</button>
                        <button class="dropdown-item" type="button">Rename File</button>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                        Git
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" type="button">Commit</button>
                        <button class="dropdown-item" type="button">Pull</button>
                        <button class="dropdown-item" type="button">Push</button>
                    </div>
                </div>
                <button id="execute" class="btn btn-sm btn-primary" type="button">
                    Run
                    <span id="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                          style="display: none"></span>
                </button>
            </div>
        </div>
        <div class="row">
            <div class="col-2 border border-dark">
                <div id="jstree"></div>
            </div>
            <div class="col-10 border border-dark">
                <div class="editor_control">
                    <textarea class="form-control" id="code" name="code" style="display: none;" rows="30">
/**
 * 简单示例
 *
 * @author jiazhifeng
 * @date 2021/12/07 10:14
 */
public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("HelloWorld");
    }
}
                    </textarea>
                </div>
            </div>
        </div>
        <div class="row border border-dark">
            <div class="col">
                <div class="form-group">
                    <textarea name="executeResult" class="form-control" id="exampleFormControlTextarea1" rows="10"
                        placeholder="控制台" readonly></textarea>
                </div>
            </div>
        </div>

    <div id="SourceCodeFileName" hidden>HelloWorld</div>
<!--    <div id="sourceCodeList">模板: </div>-->

    <script>
        $(function () {
            $('#jstree').jstree({ 'core' : {
                'data' : [
                   { "id": "测试文件夹", "parent": "#", "text": "测试文件夹" },
                   { "id": "测试文件1", "parent": "测试文件夹", "text": "测试文件1" },
                   { "id": "测试文件2", "parent": "测试文件夹", "text": "测试文件2" },
                   { "id": "HelloWorld", "parent": "#", "text": "HelloWorld.java", "icon": "jstree-file"},
                   { "id": "RemoteClassLoader", "parent": "#", "text": "RemoteClassLoader.java", "icon": "jstree-file"},
                   { "id": "RemoteMonitor", "parent": "#", "text": "RemoteMonitor.java", "icon": "jstree-file"}
                ]
            }});
            $('#jstree').on("changed.jstree", function (e, data) {
                console.log(data.selected);
                getSourceCodeByFileName(data.selected);
            });
        });

        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            mode: "text/x-java",
            lineNumbers: true,
            matchBrackets: true,
            indentUnit: 4,
            indentWithTabs: true,
        });
        editor.setSize('auto', '630');

        function getSourceCodeByFileName(name) {
            console.log(name);
            var settings = {
                "url": "/sourceCode/" + name,
                "method": "POST",
                "timeout": 0,
                "processData": false,
                "mimeType": "multipart/form-data",
                "contentType": false,
                "data": null
            };
            $.ajax(settings).done(function (response) {
                $('#SourceCodeFileName').text(name);
                editor.setValue(response);
            });
        }

        $('#execute').click(function () {
            $('#execute').attr("disabled", true);
            $('#loading').show();
            var form = new FormData();
            form.append("className", $('#SourceCodeFileName').text());
            form.append("sourceCode", editor.getValue());

            var settings = {
                "url": "/remote/executeJavaSourceCode",
                "method": "POST",
                "timeout": 0,
                "processData": false,
                "mimeType": "multipart/form-data",
                "contentType": false,
                "data": form
            };
            $.ajax(settings).done(function (response) {
                $("textarea[name='executeResult']").val(response);
                $('#execute').attr("disabled", false);
                $('#loading').hide();
            });
        });
    </script>
</body>

</html>